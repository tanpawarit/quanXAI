# System Architecture

## Project Structure

```bash
src/
â”œâ”€â”€ domain/                      # ðŸ§  Core Business Logic (Pure Python)
â”‚   â”œâ”€â”€ entities.py              # Product, SearchQuery, QueryHistory
â”‚   â”œâ”€â”€ ports.py                 # IVectorStore, ILLMProvider, ISearchClient
â”‚   â”œâ”€â”€ exceptions.py            # Domain exceptions
â”‚   â””â”€â”€ logger.py                # Logging utilities
â”‚
â”œâ”€â”€ application/                 # ðŸŽ® Orchestration & Use Cases
â”‚   â”œâ”€â”€ agent/                   # LangGraph Agent System
â”‚   â”‚   â”œâ”€â”€ graph.py             # Main orchestrator (Planner â†’ Workers â†’ Synthesizer)
â”‚   â”‚   â”œâ”€â”€ state.py             # Agent state management
â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”‚   â”œâ”€â”€ planner.py       # Query planning agent
â”‚   â”‚   â”‚   â”œâ”€â”€ product_qa.py    # Product catalog specialist
â”‚   â”‚   â”‚   â””â”€â”€ market_analysis.py  # Market research specialist
â”‚   â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”‚   â”œâ”€â”€ product_rag.py   # Hybrid search tool
â”‚   â”‚   â”‚   â”œâ”€â”€ web_search.py    # Tavily web search
â”‚   â”‚   â”‚   â”œâ”€â”€ calculator.py    # Math operations
â”‚   â”‚   â”‚   â””â”€â”€ price_analysis.py # Margin calculations
â”‚   â”‚   â””â”€â”€ prompts/             # System prompts for each agent
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                     # FastAPI REST Endpoints
â”‚   â”‚   â”œâ”€â”€ main.py              # App initialization
â”‚   â”‚   â”œâ”€â”€ dependencies.py      # Dependency injection
â”‚   â”‚   â”œâ”€â”€ schemas.py           # Request/Response models
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ query.py         # /query endpoint
â”‚   â”‚       â”œâ”€â”€ history.py       # /queries endpoint
â”‚   â”‚       â”œâ”€â”€ feedback.py      # /feedback endpoint
â”‚   â”‚       â””â”€â”€ health.py        # /health endpoint
â”‚   â”‚
â”‚   â”œâ”€â”€ pipeline/                # Data Ingestion Pipeline
â”‚   â”‚   â”œâ”€â”€ loader.py            # CSV loading
â”‚   â”‚   â”œâ”€â”€ embedder.py          # Text embedding generation
â”‚   â”‚   â””â”€â”€ ingester.py          # Orchestrates ingestion flow
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                # SQLite Persistence
â”‚   â”‚   â”œâ”€â”€ models.py            # SQLAlchemy models
â”‚   â”‚   â””â”€â”€ repository.py        # Query history CRUD
â”‚   â”‚
â”‚   â””â”€â”€ vector_store/
â”‚       â””â”€â”€ repository.py        # Milvus operations wrapper
â”‚
â”œâ”€â”€ infrastructure/              # ðŸ”Œ External Adapters (Implements Ports)
â”‚   â”œâ”€â”€ milvus/
â”‚   â”‚   â”œâ”€â”€ client.py            # Milvus connection
â”‚   â”‚   â””â”€â”€ schema.py            # Collection schema definition
â”‚   â”‚
â”‚   â”œâ”€â”€ openai/
â”‚   â”‚   â””â”€â”€ embeddings.py        # OpenAI embedding adapter
â”‚   â”‚
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â””â”€â”€ openai.py            # OpenAI LLM adapter
â”‚   â”‚
â”‚   â””â”€â”€ search/
â”‚       â””â”€â”€ tavily.py            # Tavily search adapter
â”‚
â”œâ”€â”€ cli/
â”‚   â””â”€â”€ ingest.py                # CLI for data ingestion
â”‚
â””â”€â”€ config/
    â””â”€â”€ settings.py              # Environment configuration
```

## High-Level Overview

We're keeping it real simple. We follow **Clean Architecture** and **Domain-Driven Design (DDD)**. 

Basically:
1.  **Domain**: The rules of our business. It doesn't care about databases or APIs.
2.  **Application**: The boss. It tells everyone what to do.
3.  **Infrastructure**: The worker bees. They talk to the outside world (DBs, AI models).

## Agentic Workflow

Instead of one giant brain, we use a team of agents managed by **LangGraph**. A Planner breaks down the user's question and hands off tasks to specialists.

![Hand-drawn agent workflow diagram](asset/agent_workflow.png)

## Data Flow (RAG)

When you search for a product, we don't just guess. We use **Hybrid Search** to pull real data from our Vector DB (Milvus) before answering.

![Hand-drawn data flow diagram](asset/rag_data_flow.png)
